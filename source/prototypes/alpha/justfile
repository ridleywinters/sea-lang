import x"$REPO_ROOT/source/modules/raiment-devenv/build/common.justfile"

CWD := shell('pwd')

#==============================================================================
# default
#==============================================================================

[private]
default:
    @just --list --unsorted

#==============================================================================
# ensure
#==============================================================================

ensure:
    @just ensure-build-directory

#==============================================================================
# build
#==============================================================================

build: ensure


#==============================================================================
# dev
#==============================================================================

dev: ensure
    cargo run run --backend=interpret "data/examples/001-hello-world"
    cargo run run --backend=interpret "data/examples/002-arithmetic"

#==============================================================================
# run
#==============================================================================

#==============================================================================
# test
#==============================================================================
test: ensure
    cargo test
    @just test-examples

test-examples: ensure
    @for dir in data/examples/*; do \
        [ -d "$dir" ] || continue; \
        echo "Building $dir (TypeScript)"; \
        cargo run build --backend=typescript --output="$dir/main.ts" "$dir"; \
        deno check "$dir/main.ts"; \
        echo "Building $dir (C)"; \
        cargo run build --backend=c --output="$dir/main.c" "$dir"; \
        echo "Building $dir (Rust)"; \
        cargo run build --backend=rust --output="$dir/main.rs" "$dir"; \
    done